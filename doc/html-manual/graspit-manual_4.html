<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- XML file produced from file: graspit-manual.tex
     using Hyperlatex v 2.9-in-waiting-rk (oct06) (c) Otfried Cheong
     on Emacs 22.1.1, Mon Apr 27 10:44:19 2009 -->
<head>
<title>GraspIt! User Manual -- 4 Main Data Types and Data Files</title>

<style type="text/css">
.maketitle { align : center }
div.abstract { margin-left: 20%; margin-right: 10%; }
h3.abstract  { align : center }
div.verse, div.quote, div.quotation {
  margin-left : 10%; 
  margin-right : 10%;
}
dt {font-weight: bold}
</style>
</p>
</head>
<body>
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="graspit-manual_5.html"><img border="0" alt="5 Collision and Contact Detection" src="../images/next.png"/></a></td><td bgcolor="#99ccff"><a href="graspit-manual.html"><img border="0" alt="Top" src="../images/up.png"/></a></td><td bgcolor="#99ccff"><a href="graspit-manual_3.html"><img border="0" alt="3 Getting Started" src="../images/previous.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>4 Main Data Types and Data Files</b></td><td bgcolor="#99ccff" align="center"><a href="graspit-manual.html#hlxcontents"><p>Contents</a></td></tr></table>
<h1>4 Main Data Types and Data Files</h1>
</p>
<ul>
<li><a href="#sec:bodies">4.1 Bodies</a></li>
<ul>
<li><a href="#id2">Body Files</a></li>
</ul>
<li><a href="#sec:robotfile">4.2 Robots</a></li>
<li><a href="#id4">4.3 Worlds</a></li>
</ul>
<p>There are three main types of entities in GraspIt!. The first one is a
<b>Body</b>, which is characterized by having some geometry (a
shape), a transform (its position) and material properties (such as
friction coefficient). The second one is a <b>Robot</b>, which is
comprised of multiple Bodies (such as its links) as well as
information on kinematics, actuation, etc. Finally, a <b>World</b>
groups together instances of the other classes and places them in the
correct positions relative to each other. Each of these classes has
its own data file format, which GraspIt! can load (but, with the
exception of the World, not save to). We will detail all of them in
this section.
</p>

<h2><a name="sec:bodies">4.1 Bodies</a></h2>
<p>There are two main types of bodies that exist in a GraspIt! simulation
world: static bodies (also known as obstacles) and dynamic bodies
(such as robot links and objects). Static objects do not participate
in the dynamics, but provide collision surfaces for dynamic
bodies. Note that this difference mainly applies when the dynamic
engine is being used; otherwise, dynamic bodies can be used as static
bodies as well. This document describes what makes up a basic GraspIt!
body, and what a dynamic body adds to that definition.
</p>
<p>Every GraspIt! body has the following data associated with it:
</p>
<dl><dt>Geometry:</dt><dd> this describes the shape of the body. It is stored as
an Inventor scene graph, a format similar to VRML. This structure
can contain pure shape nodes such as cubes, spheres, cylinders, and
cones, as well as sets of 2D polygons that define a
surface. Although GraspIt! (through the Inventor scene graph) can
display all of these geometry types, the collision detection system
only works with triangles. When any body is imported to a GraspIt!
world, it is faceted into triangles, and these are used for
detecting collisions and finding contact points. The units in these
files are assumed to be millimeters. Note that the origin of a
body's coordinate system is the origin of its geometry, as loaded
from a file or created by the user. This can be a tricky aspect, as
the origin of a body's geometry is fairly arbitrary. To counter
this, dynamic bodies also use the notion of center of mass,
explained below. However, the origin of a body's coordinate system
is always the origin of it's geometry.
</dd><dt>Material:</dt><dd> the material affects the amount of friction possible
at contacts on this body. For each pair of materials we define a
coefficient of friction.  When the dynamic engine is not used,
GraspIt! uses a static coefficient of friction for all bodies. When
not using dynamics, this coefficient only affects grasp quality
computations, not the relative motion of the bodies. During the
dynamic simulation, the coefficient of friction affects the relative
motion of the bodies in contact. We also use a dynamic coefficient:
if the relative speed at a contact point exceeds a threshold
currently set at 1mm/sec, a kinetic coefficient of friction is used.
</dd><dt>Transform:</dt><dd> each body keeps track of the 3D position and
orientation of its body frame relative to the GraspIt! world
coordinate system.
</dd><dt>Name:</dt><dd> a body's name is currently derived from the its filename,
except in the case robot links, which are named using the robot's
name and their kinematic chain and link numbers.
</dd></dl>
<p>Dynamic bodies also have the following properties:
</p>
<dl><dt>Mass:</dt><dd> this is expressed in grams.
</dd><dt>Center of mass:</dt><dd> this is a 3D position expressed relative to the
body coordinate system. There are two main uses for this. The first
one is to provide a stable point for grasp quality computations to
use as reference. The second one is to be used as a reference point
for transformation between forces and torques in dynamics. It should
be more stable than the origin of the body's coordinate system,
which is arbitrary.
</dd><dt>Inertia tensor:</dt><dd> this is the standard 3x3 mass distribution
matrix. It is expressed relative to a coordinate frame that is
aligned with the coordinate system of the body, but positioned at
the center of mass. When stored in a file, it is scaled by 1/mass so
that changes to the mass can be made by changing only the mass value
above.
</dd><dt>Dynamic state:</dt><dd> two values, q and v, store the current position
and velocity of the body's center of mass relative to world
coordinates. q is expressed as a 7x1 vector: the first three values
are the position, and the last four are the rotation in quaternion
form. v is expressed as a 6x1 vector: the first three values are the
linear velocity of the body, and the last three are the rotational
velocity. When the dynamics updates each body state, the body
transform is also updated. If a body is moved in the static mode,
the position value of the dynamic state is also updated.
</dd></dl>

<h3><a name="id2">Body Files</a></h3><p>
Currently, GraspIt! employs the following convention: a Body file is
just the file that stores the geometry of the body, either in Inventor
(.iv) or VRML (.wrl) format. The geometry part is read in straight by
the scene graph. However, the geometry file can be enhanced by adding
some GraspIt! specific information at the beginning. All of this
information must be placed as Inventor comments (lines starting with
the character &#35;) so that it does not affect the process of loading the
geometry. None of the GraspIt! specific information is required. If
all of it is missing, Inventor will read in the geometry from the file
and GraspIt! will assign default values to all of its parameters.
</p>
<p>GraspIt! parameters follow the convention: 
</p>
<p><tt>&#35;parameter&#95;name value</tt>
</p>
<p>Where the &#35; sign is needed to "comment out" the line from Inventor's
perspective. For the parameter&#95;name , we have the following
possibilities:
</p>
<dl><dt>material</dt><dd> the value is a string identifying the name of the
material. Possible values are: frictionless, plastic, metal, wood,
stone, rubber. Example:
<p><tt>&#35;material plastic</tt>
</p>
</dd><dt>mass</dt><dd> the value is the mass of the object, expressed in
grams. Example:
<p><tt>&#35;mass 300</tt>
</p>
</dd><dt>cog</dt><dd> stands for center of gravity. The value is composed of 3
entries, showing the coordinates of the center of gravity relative
to the origin of the geometry. Example:
<p><tt>&#35;cog 10.0 0.0 100.0</tt>
</p>
</dd><dt>inertia&#95;matrix</dt><dd> the value is composed of the 9 entries in the
body's inertia matrix, on three separate lines. Example:
<p><tt>
&#35;inertia&#95;matrix<br />&#35;4853.0     -1.1196 -6.5156<br />&#35;-1.1196    4853.0  47.542<br />&#35;-6.5156    0.0     2357.6
</tt>
</p>
</dd></dl>
<p>For more examples, see the body files included with the distribution,
in <tt>&#36;GRASPIT/models/objects</tt>.
</p>
<p>In the future, we would like to separate the GraspIt! parameters
from the geometry, and get rid of this crude parsing method. We are
considering an XML-like language, and parser, for specifying any body
parameters inside a file. This might be implemented in the next
release of GraspIt!.
</p>

<h2><a name="sec:robotfile">4.2 Robots</a></h2>
<p>A Robot is made up of multiple links, connected into kinematic
chains. A link is simply a dynamic body, as described above. A Robot
always has a base link (called "palm" for hands) and one or more
kinematic chains attached to it. Each chain is in turn made up of a
succession of links, connected by joints. In order to define a robot,
two things are needed: the Body files for all the links that are part
of the Robot, plus an overall Robot configuration file, which has all
the kinematic information and references the appropriate body files
for the links. Here we describe the structure of the Robot
configuration file.
</p>
<p>Robot configuration files can seem daunting at first, and they are a
bit annoying to get used to. However, you can start from one of the
many robots that are included with this distribution, and use it as a
starting block for your own robot that you are trying to build. For
the moment, a Robot configuration file is a simple text file which
must be parsed in the strict order given below. In the future, we hope
to move to more flexible XML-like format. In Robot configuration file,
any line that begins with the &#35; character is considered a
comment. Blank lines are ignored.
</p>
<p>A Robot configuration file has three sections. The first one has the
overall information about the Robot (type, number of kinematic chains,
number of DOF's, etc). The second part contains the information for
each kinematic chain. The third part contains some optional additional
information. Most Robot files included with this GraspIt! distribution
are also commented to show what the purpose of each line is.
</p>
<p>In this example, we will walk through the file for the Robonaut
hand. The first item in the file tells GraspIt! whether this is a
generic robot or hand or a particular subclass of one of those. A hand
should use the "Hand" class type. In some cases, if a robot has
special features or its own inverse kinematics algorithm, it is
necessary to use a subclass of these generic types, such as "Barrett",
or "Puma560":
</p>
<pre>
#Robot ClassType
Robonaut
</pre>
<p>The next item is the filename for the palm link:
</p>
<pre>
#Palm filename (considered a link)
right_palm.iv
</pre>
<p>This is followed by information on the DOF's. First comes the number
of DOF's. Then, for each DOF, a line with the information for
initializing that DOF. Note that a DOF can be connected to one or more
joints in the kinematic chains, this information will be supplied
later in the Robot configuration file. For more details about DOF's
and joints in GraspIt!, see the Joint Coupling and Underactuated Hands
chapter.
</p>
<p>For each DOF, the line with initialization information contains the following:
</p>
<ul><li>a letter showing the DOF type. For the Robonaut hand, all DOF's
are of the type "rigid", depicted by the letter "r". This is the
most common type of DOF in GraspIt!. Unless you are building robots
with coupled joints (multiple joints connected to a single DOF), you
can always use this type of DOF.
</li><li>the default velocity for that DOF during an autograsp
operation. This is used to pre-define the "closing" motion of a
hand. For anthropomorphic hands, these pre-defined directions tell
GraspIt! how to move each DOF in order to "autograsp", or how to
"close the hand". This generally means moving the DOF's of the MCP,
PIP and DIP joints in the "flexing" direction, and no movement for
the abduction - adduction DOFs.
</li><li>the max force the DOF can apply to each joint it is connected
to. The unit is N * 1.0e6 * mm for torques and N * 1.0e6 for forces.
</li><li>the Kp and Kv coefficients for a PD force controller built into
the DOF
</li><li>the visual scale of the dragger that allows the user to control
this DOF through the GraspIt! GUI.
</li><li>a number of optional parameters, depending on the DOF type. For
the "rigid" DOF, no more parameters are needed.
</li></ul>
<pre>
#number of DOFs
14

#for each DOF:
#type default_velocities_for_auto_grasp max_effort_in_N_or_Nm dragger_scale
r 0.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 0.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 0.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
r 1.0  5.0e+9 1.0e+10 1.0e+7 20
</pre>
<p>The next piece of information contained in the Robot config file is
the number of kinematic chains (also called "fingers" for hands):
</p>
<pre>
#Number of fingers
5
</pre>
<p>We then move on to the next section, which contains information for
each of the kinematic chains. We will only show here one of the five
chains in the Robonaut hand, all the other chains follow the same
convention. The first entries are the number of joints and links in
the chain. Note that these are not always equal, as you can have up
to 3 joints between two links.
</p>
<pre>
#----------------f1 - index --------------------
#number of joints
4

#number of links
4
</pre>
<p>Next comes the transform from the origin of the palm (which is also
the origin of the robot) to the base of this chain, which is where the
first joint in the chain is places. Any chain starts with a joint.
</p>
<pre>
#Transforms from palm origin to base of the finger
t 87.883873 -27.044726 -16.619068
R
0.997205 -0.074709 0.000000
0.074425 0.993411 -0.087156
0.006511 0.086912 0.996195
</pre>
<p>The next block is dedicated to the joints in the chain: one line for
each joint, with the Denavit-Hartenberg parameters and some additional
joint information. For each joint, the following entries are present:
</p>
<ul><li>the four D-H parameters, in the order theta d a alpha. Either
theta or d must be linked to a DOF number, as shown below.
</li><li>the next two values are the joint limits.
</li><li>the next values are optional (not present in the Robonaut file)
and can contain things like joint friction coefficients, spring
stiffness etc.
</li></ul>
<pre>
#Joint Descriptions (1 joint per line)
#(joints are ordered from closest to palm outward)
#(d# indicates DOF that this joint is connected to)
#(linear equations are of the form: d#*k+c [no spaces!])
#theta	d	a	    alpha	min	max
d3     	0	8.0518	90 	    -20 10
d4+-5.9	0	45.72   0      -10 85
d5     	0	26.67   0       0 	85
d5+5.9 	0	0       0  	    0 	85
</pre>
<p>Finally, we have the block that puts links and joints together. This
block consists of a list of connection types and links. The connection
type tells us how each link is connected to the one before. It can be
one of the following: "Revolute", "Prismatic", "Universal", "Ball", or
"Fixed". Depending on which one is used, the chain will take some of
the joints from the joint list above, and put them together to create
a connection of that type. For example:
</p>
<ul><li>Revolute: the link is connected to the one before by through a
single revolute joint 
</li><li>Universal: the link is connected to the one before by two
revolute joints, usually with perpendicular axes
</li><li>Ball: the link is connected to the one before by three revolute
joints, usually with perpendicular axes
</li></ul>
<p>The link entry is simply a Body file that that link can be loaded
from. This is followed by the <tt>lastJointAxis</tt> number which
tells GraspIt! the index of that last joint axis that affects that
position of that link. The joint axes are numbered from 0. We are
hoping to get away from this convoluted way of specifying connections
pretty soon.
</p>
<pre>
#Link Descriptions (1 link per line)
#filename lastJoint
#(links are ordered from closest to palm outward)
#(lastJoint is the last joint in the chain which can affect this link)
Revolute
yoke2.iv 0
Revolute
pph3l.iv 1
Revolute
mph4.iv 2
Revolute
bph3.iv 3
</pre>
<p>The last part of the Robot file contains optional information. This
usually includes things such as Eigengrasp information, connection to
a Flock of Birds sensor, etc. These are described in more detail in
the dedicated chapters of this manual.
</p>

<h2><a name="id4">4.3 Worlds</a></h2><p>
In GraspIt!, robots and bodies populate a simulation world. This
document describes how these elements can be added or deleted from a
world and describes the format of a world (.wld) file, which stores
the current state of the world.
</p>
<p>When GraspIt! begins the world is empty. The user may either load a
previously saved world by choosing File <i> -&gt; </i> Open, or populate the new
world. To import an obstacle (a static body) or an object (a dynamic
body), File <i> -&gt; </i> Import Obstacle or File <i> -&gt; </i> Import Object, and then
choose the Body file (see the previous section on bodies). Note that
any Body file (regardless of whether it's meant for a static or
dynamic body) can be loaded as an obstacle (GraspIt! will just ignore
the dynamic parameters). However, when a body file is imported as an
Object, GraspIt! will automatically instantiate it as a dynamic
body. It will also try to find the dynamic parameters in the body file
and, if it can not find them, assign default values. Be aware that the
default values occasionally have unpredictable results.
</p>
<p>To import a robot, use File <i> -&gt; </i> Import Robot, open the correct robot
folder, and select the robot configuration (.cfg) file.
</p>
<p>To delete a body, select it, and then press the &lt;DELETE&gt; key. To
remove a robot, first select the entire robot (by double-clicking one
of the links when the selection tool is active) and press the &lt;DELETE&gt;
key.
</p>
<p>Note: newly imported bodies or robots always appear at the world
origin. You can move existing bodies out of the way before importing a
new one. If you do not, than the newly imported body will overlap with
an old one, and you will have to temporarily toggle collisions in
order to move one of them out of the way.
</p>
<p>When the user selects "Save" in the file menu, GraspIt! saves the
current world state in a text world (.wld) file. In the future this
will be stored in an XML format. The first line of the file
(e.g. <tt>&#35;GraspIt! version 2.0beta</tt>) identifies this file as a
GraspIt!  file. Each block of lines following that describes on
element of the world. The end of a block is marked with a blank
line. Each block begins a line describing the type of element. This
must be one of: Obstacle, GraspableBody, Robot, Connection or
CameraFull.
</p>
<dl><dt>Obstacle:</dt><dd> the next line identifies the file name associated
with the body. The filename is relative to <tt>&#36;GRASPIT</tt>. Next
line should be a material type, and finally there is a transform
that locates the body with respect to the world coordinates. The
transform is stored by using a "T" followed by 4 numbers surrounded
by parenthesis to represent the body orientation as a quaternion,
and 3 numbers surrounded by brackets to represent the body position.
</dd><dt>GraspableBody:</dt><dd> the block is the same except the material line
is omitted (the material is found in the body file).
</dd><dt>Robot:</dt><dd> the second line after this keyword identifies the robot
configuration file. The third line contains values for DOF in the
robot. Note that this might mean a single number per DOF or more
information, depending on the DOF type. The last line is the
transform described above.
</dd><dt>Connection:</dt><dd> indicates a connection between two robots. The
second line of the block contains 3 numbers. The first is robot
index of the parent robot, starting at 0. The second number is the
kinematic chain number on the parent robot that the other robot is
attached to. The third number is the index of the child robot. The
next line (can be empty) specifies a body that is optionally used as
a mount piece between the two robots. The last line of the block is
the constant offset transform between the last link of the parent's
kinematic chain and the base link of the child robot.
</dd><dt>CameraFull:</dt><dd> specifies the position, orientation and focal point
of the camera. The next line contains 8 numbers: the first 3 are the
camera position in World coordinates, the next 4 are the camera
orientation specified as a quaternion, and the last one is the focal
distance of the camera.
</dd></dl>
<p>For an example, take a look at the <tt>barrettGlassDyn.wld</tt> file
supplied with this GraspIt! distribution.
</p>
<hr /><address><p>Copyright (C) 2002-2009 Columbia University</address><br />
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="graspit-manual_5.html"><img border="0" alt="5 Collision and Contact Detection" src="../images/next.png"/></a></td><td bgcolor="#99ccff"><a href="graspit-manual.html"><img border="0" alt="Top" src="../images/up.png"/></a></td><td bgcolor="#99ccff"><a href="graspit-manual_3.html"><img border="0" alt="3 Getting Started" src="../images/previous.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>4 Main Data Types and Data Files</b></td><td bgcolor="#99ccff" align="center"><a href="graspit-manual.html#hlxcontents">Contents</a></td></tr></table></body></html>
